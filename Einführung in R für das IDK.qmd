---
title: "Einführung in R für IDK"
author: "Lorenz Biberstein, IDK, ZHAW"
date: "`r Sys.time()`"
date-format: medium
format:
  html:
    embed-resources: true
always_allow_html: true
toc: true
toc-depth: 5
toc-title: "Inhalt"
toc-location: left
number-sections: true
number-depth: 3
lang: "de-DE"
---

# Einleitung

## To do

-   Deskriptive Analysen, alltägliche Anwendungen für uns
-   Mehr Grundsätzliches am Anfang, weniger Fortgeschrittenes
-   Alle benutzten Codes aus den Chunks in R Skript übertragen

```{r}
#| echo: false
#| warning: false
library(here) # Für saubere Pfade
library(readr) # Import von Daten in versch. Formaten
library(readxl) # Import von Excel
library(ggplot2) # Schöne Abbildungen
library(vtable) # Beschreibung von Daten
library(janitor) # Für schöne Tabellen
library(haven) # Import von SPSS, Stata etc.
```

```{r setting}
#| echo: false
#| warning: false
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE
)
```

## R und RStudio

-   Basisprogramm ist R
-   Benutzt wird es aber meistens über RStudio
-   Installieren aus Software Center
    -   Zuerst R (muss später nie mehr geöffnet werden), dann RStudio (GUI) (@fig-rstudio)

![R und RStudio im Software Center](images/Screenshot.png){#fig-rstudio}

![Layout RStudio](images/image-267797392.png){#fig-layout-rstudio}

-   RStudio ist unterteilt in verschiedene Fenster (die sich unterschiedlich anordnen lassen, siehe @fig-layout-rstudio)
-   Am wichtigsten:
    -   Konsole für freie Eingage von Code (hier unten links) und Output von Analysen
    -   Skript (oben links)
    -   Daten & Objekte ("Environment"; oben rechts)
    -   Projektordner ("Files"; unten rechts)
    -   Abbildungen ("Plots"; unten rechts)

## Unterschied zu SPSS

-   Skripte und Konsole

-   R kann verschiedene Objekte gleichzeitig laden (oben rechts in "Environment"; @fig-environment), diese können verschiedene Strukturen haben

![Environment mit verschiedenen geladenen Objekten](images/Screenshot%20(40).png){#fig-environment}

-   Gleichzeitig geladene Objekte können verschieden Strukturen haben:
    -   Klassische Datensätze mit Fällen in Zeilen und Variablen in Spalten (meistens als "data frame" oder "tibble")
    -   Nur ein einzelner Wert
    -   Vektoren / Matrizen
    -   "Klassische" Datensätze (als "data frame" oder "tibble")
    -   Listen (z.B. Resultate von Analysen, Koeffizienten, Parameter etc., falls diese einem Objekt zugewiesen werden, siehe @sec-objekte)
-   Befehle müssen die zu benutzenden Daten eindeutig identifizieren
    -   Z.B. `mean(iris$Sepal.Width)` -\> bezieht sich auf die Variable "Sepal.Width" im Datensatz "Iris"
-   R ist case sensitive! "x" ist nicht das gleiche wie "X"!
-   Daten können auch angeschaut werden (mit `View(df)`), aber insgesamt ist die Anwendung viel mehr Code-basiert
-   Nicht wie in SPSS versch. Fenster für Syntax, Output und Daten, sondern alles in einem Fenster (Ausnahmen sind möglich, z.B. zusätzliches Fenster für Abbildungen)

## Projekte

-   Sehr zu empfehlen, sobald man nicht nur eine einzelne quick and dirty-Analyse machen will: Projekt anlegen
    -   File -\> New Project -\> (@fig-new-project)
        -   Auswahl aus verschiedenen Ablagemöglichkeiten. Am einfachsten: "New Directory".
        -   Falls mit Versionskontrolle gearbeitet wird (siehe @sec-github): "Version Control"

![Neues Projekt eröffnen](images/Screenshot%20(39).png){#fig-new-project}

-   Vorteile:
    -   Ein Hauptordner für ganzes Projekt
    -   R kann Einstellung pro Projekt speichern
    -   R weiss, welche Skripte, Daten etc. zu welchem Projekt gehören
    -   In RStudio von Projekt zu Projekt wechseln, vereinfacht Organisation
-   Getrennte Unterordner für Daten, Analysen, Abbildungen, Bericht etc.
-   Pfade à la "`C:\Users\bibs\OneDrive - ZHAW\R\Einführung in R für das IDK`" sind verpönt, weil nicht anwendbar auf anderen Geräte / für andere Benutzer
-   Allgemein gültige Pfade mit dem Projekt `here: library(here)`
    -   "`here() starts at C:/Users/bibs/OneDrive - ZHAW/R/Einführung in R für das IDK`"
    -   Daten einlesen mit `Churn <- read_table(here("Daten", "Churn.csv"))` funktioniert für alle Personen, solange sie in ihrem Hauptprojektordner einen Unterordner "Daten" haben, in dem die Daten "Churn.csv" abgelegt sind

## Base R vs. Pakete ("libraries")

-   Basisinstallation ist "Base R" ({base}); kommt bereits mit sehr vielen Anwendungen
-   Weitere bereits installierte Pakete:
    -   {stats} für statistische Anwendungen
    -   {graphics} für einfache Abbildungen
-   Verschiedene mehr oder weniger spezielle Anwendungen benötigen aber spezielle Pakete
-   Paket installieren (nur beim ersten Mal): `install.packages("ggplot2")`
-   Paket laden für Nutzung: `library(ggplot2)` (Keine Anführungszeichen nötig)
-   Achtung, wenn verschiedene Pakete *Funktionen mit gleichem Namen* verwenden!
-   Dann muss ggf. das Paket mit zwei Doppelpunkten vorangestellt werden (R zeigt beim laden der beiden fraglichen Pakete an, welche Funktion aus welchem Paket benutzt wird):
    -   `dplyr::filter()`
    -   `stats::filter()`
-   Unterschied zu SPSS: Dort gibt es keine verschiedenen Pakete, alle Funktionen sind für SPSS klar und eindeutig...
-   Einige Funktionen kommen auch identisch in versch. Paketen vor!

# Daten in R

## Einfache Eingabe und Zuweisung an *Objekte* {#sec-objekte}

-   Normale Eingabe von Code in Konsole:

```{r, echo = TRUE}
1 + 2
```

-   Zuweisung des Werts an Objekt "x" mit Pfeil:

```{r, echo = TRUE}
x <- 1 + 2
x
```

-   Benutzung des Objekts "x":

```{r, echo = TRUE}
x + 4
```

-   Eingabe mehrere Werte als Vektor:

```{r, echo = TRUE}
y <- c(4, -4)
y
```

-   Komplizierteres:

```{r, echo = TRUE}
# x (3) plus 4 und minus 4, ergibt zwei Werte
x + c(4,-4)

# Gleiches Resultat, weil y vorher als 4 / -4 definiert
x + y
```

-   Code ausführen
    -   Entweder in R Skript mit Ctrl + Enter
    -   Oder in Konsole individuell
-   *Objekte können geschachtelt werden!*

## Datenformate

-   R kann Informationen in verschiedenen Formaten speichern - Vektoren - Matrizen

```{r, echo = TRUE}
d = seq(from = 1,to = 12) # Vektor mit Zahlen von 1 bis 12
d # Gibt das Objekt "d" im Output aus
View(d) # Anzeigen von "d"
str(d) # Struktur von "d"

m = matrix(data = d, nrow = 3, byrow = FALSE) 
# Vektor d in Matrix mit 3 Reihen umwandeln (ergibt Matrix 3 x 4)
m # Gibt das Objekt "d" im Output aus
View(m) # Anzeigen von "m"
str(m) # Struktur von "m"
```

## Importieren von Daten

-   Für uns sind am ehesten "klassische" Datensätze relevant - Spalten sind Variablen - Zeilen sind Beobachtungen / Fälle
-   Je nach Dateiformat sind zum Import Pakete notwendig (oder zumindest hilfreich)
-   Manuell / quick and dirty: Unten rechts den entsprechenden Ablageordner suchen -\> Klicken -\> "Import dataset"

![Datenimport eines CSV via Menu](images/image-874524877.png){#fig-datenimport-menu}

-   Oder - besser (Reproduzierbarkeit!) - via Code: Unterschiedlich je nach Datenformat.

```{r, echo = TRUE}
# csv
Churn <- readr::read_table(here("Daten", "Churn.csv"))

# txt
Arrivals <- readr::read_table(here("Daten", "Arrivals.txt"))

# Excel
alpenquer <- readxl::read_excel(here("Daten", "Alpenquerender_Gueterverkehr_Schiene.xls"))

# rda (eigenes R-Format)
load(here("Daten", "Treibstoffpreise_CH.rda"))
# Daten müssen hier keinem Objekt mehr zugewiesen werden!
```

-   Import von SPSS- oder STATA-Daten mit dem Paket `haven`
    -   **Achtung**: R geht mit Labels ganz anders um, können ggf. nicht importiert werden!

```{r}
# Import von SPSS
car_sales <- haven::read_spss(here("Daten", "car_sales.sav"))
```

## Dimensionen und Eigenschaften von Matrizen und data frames

-   Informationen über geladene Daten / Objekte erhalten
-   Hier mit den von R bereitgestellten Daten "iris": Laden mit `data(iris)` (Information zu Schwertlilien)

```{r, echo = TRUE}
data("iris")
View(iris)
str(iris) # Datentypen
```

```{r, echo = TRUE}
dim(iris)
nrow(iris) # Anzahl Fälle / Reihen
ncol(iris) # Anzahl Variablen / Spalten
length(iris) 
# Anzahl Variablen / Spalten (ACHTUNG: in diesem Fall, bei Vektoren gibt es die Länge des Vektors!)
class(iris)
head(iris) # Zeigt erste 6 Beobachtungen
tail(iris) # Zeigt letzte 6 Beobachtungen
summary(iris)
```

# Analysen

## Einfache deskriptive Statistiken

```{r, echo = TRUE}
# Mittelwert von Sepal.Length in iris
mean(iris$Sepal.Length)

# Mittelwert als Objekt abspeichern
sepal_length_mean <- mean(iris$Sepal.Length)
sepal_length_mean

# Ditto Median
sepal_length_median <- median(iris$Sepal.Length)
sepal_length_median

# Einfache Zusammenfassung der Variable
summary(iris$Sepal.Length)
```

-   Alternative z.B. mit dem Paket {vtable}

```{r, echo = TRUE}
# Zusammenfassung der Variablen (inkl. Klasse)
vtable:::vtable(iris)

# Summary statistics
vtable:::sumtable(iris)

# Summary statistics, getrennt nach "Species"
vtable:::sumtable(iris,
                  group = 'Species', # summary statistics groupiert nach Variable "Species"
                  group.test = TRUE) # Zeigt statistische Signifikanztests zwischen den Gruppen
```

## Einfache Häufigkeiten

-   Einfache Häufigkeitstabellen sind in R nicht gleich einfach wie in SPSS (siehe @sec-schwaechen)

```{r, echo = TRUE}
# Mit Basisfunktion "table"
table(iris$Species)
```

-   Alternative mit Paket {janitor}

```{r}
janitor::tabyl(iris$Species)

# Alternative Schreibweise mit tidyverse-Stil
iris |> 
  janitor::tabyl(Species)
```

## Kreuztabellen

```{r}
# Daten laden
data("ToothGrowth") # Load training data "Toothgrowth" (from guinea pigs)

table(ToothGrowth$supp, ToothGrowth$dose)
```

# Abbildungen

-   Für einfache Anwendungen ist `plot()` (aus dem Standardpaket {graphics}) genügend; gibt schon einiges her
-   Mehr Individualisierung mit Paket `ggplot2` (@sec-ggplot)
-   Manchmal erkennt R die Daten auch automatisch und macht den richtigen Plot, z.B. macht `plot(iris)` automatisch einen pairs-Plot (weil der ganze Datensatz angegeben wurde; @fig-iris-pairs), `plot(iris$Species)` macht automatisch ein Säulendiagramm der Variable "Species" (@fig-iris-species)

```{r}
#| label: fig-iris-pairs
#| fig-cap: "Pairs-Plot aller Variablen in iris"

plot(iris)
```

```{r}
#| label: fig-iris-species
#| fig-cap: "Säulendiagramm 'Species'"

plot(iris$Species)
```

## Histogramm

-   Dazu weitere Beschriftungen mit `xlab` (Label der X-Achse), `ylab` und `main`.

```{r, echo = TRUE}
#| label: fig-iris-hist-sepallength
#| fig-cap: "Histogramm Sepal Length mit Mittelwert (rot)"


hist(iris$Sepal.Length,
     xlab = "Länge in cm",
     ylab = "Häufigkeit",
     main = "Sepal Length")

# Horizontale Linie einfügen
abline(h = mean(iris$Sepal.Length), # Höhe der Linie = Mittelwert 
       col="red", # Farbe der Linie
       lwd = 2) # Dicke des Striches
```

## Boxplot

-   Für mehr Übersichtlichkeit Code umbrechen!
-   Zwei Variablen mit Tilde (\~) trennen

```{r, echo = TRUE}
#| label: fig-iris-boxplot-sepallength
#| fig-cap: "Boxplot Sepal Length"

# Erste Schreibweise, Data nicht explizit zugewiesen
boxplot(iris$Sepal.Length,
        ylab = "Länge in cm",
        main = "Sepal Length")

```

```{r}
#| label: fig-iris-boxplot-sepallength-species
#| fig-cap: "Boxplot Sepal Length nach Species"

boxplot(Sepal.Length ~ Species,
        data = iris, # Andere Schreibweise, Data explizit zugewiesen
        ylab = "Länge in cm",
        xlab = "Species",
        main = "Sepal Length nach Species")
```

## Pairs

-   Ersten Überblick gewinnen, nicht zu viele Variablen gleichzeitig!
-   Wenig sinnvoll bei nicht-metrische Variablen (siehe "Species")

```{r, echo = TRUE}
# Alle Variablen von iris
pairs(iris)

# Befehl eingeschränkt auf Spalten 1:4 von iris 
# (und alle Zeilen, keine Eingabe vor Komma)
pairs(iris[,1:4])
```

# Schwächen von R (zumindest im Vergleich zu SPSS) {#sec-schwaechen}

-   Keine Labels
-   Umgang mit fehlenden Werte
-   Gewichtung von Daten?
-   Pakete können umgeschrieben werden, Code kann sich ändern
-   Einfache Häufigkeits- und Kreuztabellen mit Prozenten sind nicht gleich schnell

# Weitere Objekte

## Resultate von Analysen

-   Objekte in R müssen nicht zwingend Zahlen oder Datensätze sein. Als Objekte können auch gespeichert werden:
    -   Resultate von Analysen
    -   Zeitreihen
    -   Listen
    -   etc.

```{r}
# Einfache lineare Regression
fit_iris <- lm(Sepal.Length ~ Sepal.Width + Petal.Length + Petal.Width, data = iris)

# Zusammenfassung des Modells
summary(fit_iris)

plot(fit_iris$residuals)
plot(fit_iris$coefficients)
```

-   Auf einzelne Objekte der Resultate kann wiederum zugegriffen werden

```{r}
fit_iris$coefficients
```

## Zeitreihen

-   Sieht ähnlich aus wie normaler Datensatz, ist aber für R als Zeitreihe erkennbar

```{r}
# Zeitreihe
data("AirPassengers")
AirPassengers
str(AirPassengers)
```

# Wo finde ich Hilfe?

-   bibs\@zhaw.ch
-   Google
-   R-Hilfe: In der Konsole mit Fragezeichen den Begriff eingeben, z.B. `?median` (@fig-help-median}), `?boxplot` (@fig-help-boxplot) oder `?filter` (@fig-help-filter).

![Hilfe zu median (Paket {stats})](images/Screenshot%20(37).png){#fig-help-median}

![Hilfe zu boxplot (Paket {graphics})](images/Screenshot%20(36).png){#fig-help-boxplot}

![Hilfe zu filter (zwei Pakete; davon das gewünschte Auswählen)](images/Screenshot%20(38).png){#fig-help-filter}

# Weiterführendes

## R-Skript vs. Markdown / Quarto

-   Skripte für reine Analysen, Text muss auskommentiert werden (analog zu SPSS-Syntax)

```{r}
1 + 1 # Code auskommentieren mit hashtag

# Mittelwert der Zahlen 1, 2, 3, 4 berechnen
mean(c(1,2,3,4))

# Gleiches Resultat
mean(1:4)
```

-   Markdown / Quarto: Primär Text-Dokumente, Code muss eingefügt werden in sogenannten "Chunks" (in Quarto sind auch Chunks für Python und andere Sprachen möglich!)
-   Python funktioniert ähnlich, aber anders als R, siehe folgender Chunk (aber ausgaben in diesem Dokument scheint leicht anderer Logik zu folgen als bei einem R-Chunk)

```{python}
# Statistikpaket für python laden
import statistics

# Daten definieren
data1 = [1, 3, 4, 5, 7, 9, 2]

# Mittelwert ausrechnen
statistics.mean(data1)

# Auch mit python können in RStudio Objekte definiert werden
x = statistics.mean(data1)

# x ausgeben
x

# Printen mit Text
print("Mean is:", x)
```

-   Erster Code ist in R, zweiter in Python

## Tidyverse

-   Meist verbreitetes Paket für Datenaufbereitung, -analyse und -visualisierung
-   Zentral:
    -   Jede Variable ist eine Spalte

    -   Jede Beobachtung ist eine Zeile

    -   (entspricht sowieso dem, was wir von unseren Daten normalerweise kennen)
-   Eigene Syntaxstruktur
-   Zusammengesetzt aus verschiedenen Paketen (tidyverse = ganzes Universum)
    -   ggplot2 (gg = Grammar of Graphics, siehe @sec-ggplot)

    -   dplyr: Datenmanipulation

    -   tidyr: Daten bereinigen

    -   readr: Daten einlesen in verschiedenen Formaten

    -   string: Umgang mit string-Variablen

    -   forcats: Umgang mit kategoriellen Variablen

    -   etc. ...
-   Nutzung
    -   `library(tidyverse)`: Lädt ganzes Universum (alle Pakete)
    -   `library(ggplot)`: Lädt nur Paket "ggplot2"
-   <https://www.tidyverse.org/>
-   Open source Lehrbuch zum Tidyverse: "[R for Data Science](https://r4ds.had.co.nz/)" von Wickham und Grolemund (Hadley Wickham ist Chief Scientist bei Posit, der Firma, die RStudio betreibt)

## ggplot2 {#sec-ggplot}

-   Paket zur Datenvisualisierung, Teil des "Tidyverse"-Universum
-   Gleiche Syntaxlogik wie andere "Tidyverse"-Pakete

```{r, echo = TRUE}
hist(iris$Sepal.Length,
     xlab = "Länge in cm",
     ylab = "Häufigkeit",
     main = "Sepal Length (mit Base R)")

# Variante 1 mit ggplot2
ggplot(iris) +
    aes(x = Sepal.Length) +
    geom_histogram() +
    labs(
        x = "Länge in cm",
        y = "Häufigkeit",
        main = "Sepal Length (mit ggplot, Var. 1)"
    )

# Variante 2 mit ggplot2
ggplot(iris) +
    aes(x = Sepal.Length) +
    geom_histogram(binwidth = 0.2) +
    facet_wrap(~ Species) +
    labs(
        x = "Länge in cm",
        y = "Häufigkeit",
        main = "Sepal Length (mit ggplot, Var. 2)"
    )

# Variante 3 mit ggplot2
ggplot(iris) +
    aes(x = Sepal.Length, 
        fill = Species) +
    geom_histogram(binwidth = 0.2,
                   alpha = 0.5, 
                   position = "identity") +
    theme_minimal() +
    labs(
        x = "Länge in cm",
        y = "Häufigkeit",
        main = "Sepal Length (mit ggplot, Var. 3)"
    )
```

## Quarto

-   Erstellen von Publikationen direkt in RStudio (zum Beispiel dieses Dokument)
-   Output in div. Formaten möglich (Word, PDF, Folien, HTML)
-   Kein Copy/Paste von SPSS zu Excel zu Word!

## Github {#sec-github}

-   Versionsontrolle
-   Code teilen mit anderen Personen auf <https://github.com>
-   Eigene Version für ZHAW: <https://github.zhaw.ch/>
